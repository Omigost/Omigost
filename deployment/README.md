# Omigost Project Deployment Toolkit

![Omigost logo](https://raw.githubusercontent.com/Omigost/Omigost/master/frontend/src/assets/img/omigost_logo.svg)

## Deploying Omigost

### Toolkit requirements

To use the toolkit you must have installed:

* Python3 with pip3 (runnable from console)
* Bash

### Available profiles

Those are all currently available profiles:
* `dev` (deploy Omigost application with entire Localstack environment - do not use any AWS data but rather fake environment)

### Usage

From the root of Omigost project you can run single command to deploy the application:
```bash
    $ ./deployment/deploy <profile>
```
The `<profile>` is name of the profile (see *Available profiles* section) you want to deploy. Profiles are stored within `deployment` directory.
Each profile has own `docker-compose.yml` which is then exported to autogenerated `Dockerrun.aws.json`.

By default AWS keys are loaded from the following environmental variables:
```bash
    export AWS_KEY='key'
    export AWS_SECRET='secret
```

You can change that using command with `-k` and `-s` options: `./deployment/deploy -k <env_key_name> -s <env_secret_name>`.
The scripts looks for variables called `<env_key_name>` and `<env_secret_name>`. If they do not exist then it tries to
use exact value specfied as parameter so you can directly pass your credentials:
```bash
    ./deployment/deploy -k AWSKEY123123213 -s AWSSECRET213123
```
Note that **it's very unsafe to pass credentails like this and you have been warned**

You can type the following command to get detailed info about script usage:
```bash
    $ ./deployment/deploy --help
```

## Notes for developers

The `Dockerrun.aws.json` configuration file is generated by deployment script - `./deployment/deploy.py` from profile `./deployment/<profile>/docker-compose.yml` file.

The toolkit exports the following tasks to create and publish docker images:
```bash
    $ ./gradlew buildDockerImages
    $ ./gradlew pushDockerImages
```

The images are needed to deploy the application with `./deployment/deploy` script as the `Dockerrun.aws.json` uses images directly from DockerHub.

That's why changing sources locally will take no effect on the deployed applciation. You must firstly build and deploy the image.